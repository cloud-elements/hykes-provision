#!/usr/bin/env bats

@test "init should succeed predictably" {
  if [ -z "${HYKES_PROVISIONER_BLUEPRINT}" ] || [ -z "${HYKES_PROVISIONER_PASSWORD}" ] || [ -z "${HYKES_PROVISIONER_TOKEN}" ]; then
    skip "Environment variables not defined"
  fi

  build/bin/hykes-provisioner init \
    --blueprint=${HYKES_PROVISIONER_BLUEPRINT} \
    --password=${HYKES_PROVISIONER_PASSWORD} \
    --token=${HYKES_PROVISIONER_TOKEN}
}

@test "init should fail predictably" {
  if [ -z "${HYKES_PROVISIONER_BLUEPRINT}" ] || [ -z "${HYKES_PROVISIONER_PASSWORD}" ] || [ -z "${HYKES_PROVISIONER_TOKEN}" ]; then
    skip "Environment variables not defined"
  fi

  build/bin/hykes-provisioner init \
    --blueprint=blueprint \
    --password=password \
    --token=token
}

@test "--help should output usage" {
  run build/bin/hykes-provisioner --help
  [ $status -eq 0 ]
  [ "${#lines[@]}" -gt 1 ]
}

@test "-h should output usage" {
  run build/bin/hykes-provisioner -h
  [ $status -eq 0 ]
  [ "${#lines[@]}" -gt 1 ]
}

@test "--version should output version" {
  run build/bin/hykes-provisioner --version
  [ $status -eq 0 ]
  [ $(expr "$output" : "v*") -ne 0 ]
}

@test "-v should output version" {
  run build/bin/hykes-provisioner -v
  [ $status -eq 0 ]
  [ $(expr "$output" : "v*") -ne 0 ]
}
